---
title: "1つ上の潜在成長曲線モデル"
author: 竹林 由武(統数研)
date: 2016-3-27 @Hirosima.Univ
output:
  revealjs::revealjs_presentation:
    theme: white
    hilight: default
    center: false
    transition: fade
    incremental: true
    fig_width: 7
    fig_height: 6
    fig_caption: true    
    reveal_options:
      slideNumber: true
      previewLinks: true
---

```{r, results='hide',echo=F,message=F,warning=F}
library(knitr)
opts_chunk$set(warning=F, message=F,echo=F)
```


## Topics

###　

### 非線形の成長曲線モデル

- Piecewise models
- Polynominal model
- Latetn basis model


### 多変量の成長曲線モデル

- Autoregressive Latent Trajectory Model
- Latent Change Score Model


## 非線形の成長曲線モデル

### Piecewise models

- あるイベントの前後の期間での変化の程度に差があるかを検討
- singe intercept model
- incremental model
- two intercept model

```{r}
data<-read.table("data/health.dat", header=F, sep=" ")

hist(data$V1)
library()

```


## single intercept model

### 潜在切片(η0)の因子負荷
- 全て1に固定
### 潜在傾き(η1:イベント前)の因子負荷
- イベント以降の負荷を同値に固定
- 0, 1, 2, 3, 3, 3

### 潜在傾き(η1:イベント後)の因子負荷
- イベント以前の負荷を0に固定
- 0, 0, 0, 0, 1, 2

## incremental model
### 潜在切片(η0)の因子負荷
- 全て1に固定
### 潜在傾き(η1:イベント前)の因子負荷
- イベント以降の負荷を同値に固定
- 0, 1, 2, 3, 4, 5

### 潜在傾き(η1:イベント後)の因子負荷
- イベント以前の負荷を0に固定
- 0, 0, 0, 1, 2, 3

## two intercept model
### 潜在切片(η0:イベント前)の因子負荷
- 全て1に固定
- 1, 1, 1, 0, 0, 0

### 潜在切片(η0:イベント後)の因子負荷
- 全て1に固定
- 0, 0, 0, 1, 1, 1

### 潜在傾き(η1:イベント前)の因子負荷
- イベント以降の負荷を同値に固定
- 0, 1, 2, 2, 2, 2

### 潜在傾き(η1:イベント後)の因子負荷
- イベント以前の負荷を0に固定
- 0, 0, 0, 1, 2, 3


## example of piecewise models 
### 潜在切片(η0:イベント後)の因子負荷
- 全て1に固定
- 1, 1, 1, 1, 1, 1

### 潜在傾き(η1:イベント前)の因子負荷
- イベント以降の負荷を同値に固定
- 0, 1, 2, 3, 4, 5

### 潜在傾き(η1:イベント後)の因子負荷
- イベント以前の負荷を0に固定
- 0, 1, 4, 9, 16, 25


## Quadratic slope model

## time coding
### 二次曲線以上のモデルでは、時間変数を中心化した方が良い。
- slope因子間の相関が非常に高いために生じる多重共線性を避ける

- instantaneouse rate of change
- Orthogonal Polynomials

## time coding
- 切片の推定値 = 時点全体の平均
- 遷移のパターンを把握するためには、予測値を求める



## Differential Equation model

## Latent basis model
### データドリブンにパターンを推定
### 潜在切片(η0:イベント後)の因子負荷
- 全て1に固定
- 1, 1, 1, 1, 1, 1

### 潜在傾き(η1:イベント前)の因子負荷
- 2時点目以降は自由推定
- 0, 1, 2, 3, 4, 5



## 自己回帰モデル
### auto-regressive model

```{r, echo=F}
library(DiagrammeR)
library(magrittr)
grViz("
digraph boxes_and_circles {
  rankdir=LR; //
  # a 'graph' statement
  graph [overlap = true, fontsize = 10]

  # several 'node' statements
  node [shape = box,
        fontname = Helvetica]
  A1; A2; A3; A4; A5;
  B1; B2; B3; B4; B5;
  C1; C2; C3; C4; C5;

  # several 'edge' statements
  B1->B2 B2->B3 B3->B4 B4->B5
  A1->A2 A2->A3 A3->A4 A4->A5
  B1->A2 B2->A3 B3->A4 B4->A5
  A1->B2 A2->B3 A3->B4 A4->B5
  B1->C2 B2->C3 B3->C4 B4->C5
  A1->C2 A2->C3 A3->C4 A4->C5
  C1->C2 C2->C3 C3->C4 C4->C5
  C1->B2 C2->B3 C3->B4 C4->B5
  C1->A2 C2->A3 C3->A4 C4->A5

}
")
```


```{r, echo=F}
library(DiagrammeR)
library(magrittr)
grViz("
digraph boxes_and_circles {
  rankdir=LR; //
  # a 'graph' statement
  graph [overlap = true, fontsize = 10]

  # several 'node' statements
  node [shape = box,
        fontname = Helvetica]
  A1; A2; A3; A4; A5;

  # several 'edge' statements
  A1->A2 A2->A3 A3->A4 A4->A5
}
")
```


```{r, echo=F}
library(DiagrammeR)
library(magrittr)
grViz("
digraph boxes_and_circles {
  rankdir=LR; //
  # a 'graph' statement
  graph [overlap = true, fontsize = 10]

  # several 'node' statements
  node [shape = box,
        fontname = Helvetica]
  A1; A2; A3; A4; A5;

  node [shape = circle,
        fontname = Helvetica]
  I; S;

  # several 'edge' statements
  I->A1 I->A2 I->A3 I->A4 I->A5
  S->A1 S->A2 S->A3 S->A4 S->A5
  A1->A2 A2->A3 A3->A4 A4->A5
}
")
```

## 自己回帰潜在遷移モデル
#### Auto-regressive Latent Trajectory Model

```{r}

```

## 潜在差得点モデル

```{r, echo=FALSE}
graph <-
  create_graph() %>%
  set_graph_name("DAG") %>%
  set_global_graph_attr("graph", "overlap", "true") %>%
  set_global_graph_attr("graph", "fixedsize", "true") %>%
  set_global_graph_attr("node", "color", "blue") %>%
  set_global_graph_attr("node", "fontname", "Helvetica") %>%
  add_n_nodes(11) %>%
  select_nodes_by_id(1:4) %>% 
  set_node_attr_with_selection("shape", "box") %>%
  set_node_attr_with_selection("type", "box") %>%
  clear_selection %>%
  select_nodes_by_id(5:7) %>% 
  set_node_attr_with_selection("shape", "circle") %>%
  set_node_attr_with_selection("type", "circle") %>%
  clear_selection %>%
  select_nodes_by_id(8:11) %>% 
  set_node_attr_with_selection("shape", "box") %>%
  set_node_attr_with_selection("type", "box") %>%
  clear_selection %>%
  add_edge(1, 5) %>% add_edge(2, 6) %>%
  add_edge(3, 9) %>% add_edge(4, 7) %>%
  add_edge(5, 8) %>% add_edge(5, 10) %>%
  add_edge(7, 11) %>% 
  select_edges %>%
  set_edge_attr_with_selection("color", "green") %>%
  add_edge(1, 8) %>% add_edge(3, 6) %>%
  add_edge(3, 11) %>% add_edge(3, 7) %>%
  add_edge(5, 9) %>% add_edge(6, 10) %>%
  select_edges("color", "^$") %>%
  set_edge_attr_with_selection("color", "red") %>%
  clear_selection

render_graph(graph)
```


